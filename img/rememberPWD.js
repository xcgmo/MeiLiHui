var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(g){var c,e,a;var f,d,b;a=g.length;e=0;c="";while(e<a){f=g.charCodeAt(e++)&255;if(e==a){c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt((f&3)<<4);c+="==";break}d=g.charCodeAt(e++);if(e==a){c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=base64EncodeChars.charAt((d&15)<<2);c+="=";break}b=g.charCodeAt(e++);c+=base64EncodeChars.charAt(f>>2);c+=base64EncodeChars.charAt(((f&3)<<4)|((d&240)>>4));c+=base64EncodeChars.charAt(((d&15)<<2)|((b&192)>>6));c+=base64EncodeChars.charAt(b&63)}return c}function base64decode(h){var g,f,d,b;var e,a,c;a=h.length;e=0;c="";while(e<a){do{g=base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&g==-1);if(g==-1){break}do{f=base64DecodeChars[h.charCodeAt(e++)&255]}while(e<a&&f==-1);if(f==-1){break}c+=String.fromCharCode((g<<2)|((f&48)>>4));do{d=h.charCodeAt(e++)&255;if(d==61){return c}d=base64DecodeChars[d]}while(e<a&&d==-1);if(d==-1){break}c+=String.fromCharCode(((f&15)<<4)|((d&60)>>2));do{b=h.charCodeAt(e++)&255;if(b==61){return c}b=base64DecodeChars[b]}while(e<a&&b==-1);if(b==-1){break}c+=String.fromCharCode(((d&3)<<6)|b)}return c}String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};var loginbaseUrl=$("#contextPath").val();$().ready(function(){loginbaseUrl=$("#contextPath").val();var h=$("#hkBasePath").val();var k=$("#basePath").val();var b=getCookie("glms_uu");var i=getCookie("glms_up");var g;var j=isLogins();var c=getCookie("isRemembered");var a=location.href;var l="";if(a.indexOf(h)!=-1){l=k}else{l=h}if(j==="login"){$.ajax({type:"post",datatype:"json",async:false,url:loginbaseUrl+"/user/getUserInfo",success:function(p){g=p.result;if(g!=null&&g!=""){Setcookie("isLogin","yes",60*60*1000);var n=getLoginHtml(k,g);var o=$("#headermystow");o.attr("href",$("#contextPath").val()+"/PbMyStowe/brandCollection");$("#ul_header").children().remove();$("#ul_header").append(n)}else{var n=getNoLoginHtml(loginbaseUrl,k);var o=$("#headermystow");o.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(n)}var m=getCookie("mlh_mei_credential");if(typeof(m)!=="undefined"&&m!=""){handleSSO(h,l,b,i,m)}},error:function(){g="fail"}})}else{if(typeof(c)==="undefined"||c==="yes"){var f=getCookie("mlh_mei_credential");if(typeof(f)!=="undefined"&&f!=""){handleSSO(h,l,b,i,f);$.ajax({type:"post",datatype:"json",async:true,url:loginbaseUrl+"/user/checkCredential",success:function(o){g=o.resp;if(g!=null&&g!=""){Setcookie("isLogin","yes",60*60*1000);var m=getLoginHtml(k,g);var n=$("#headermystow");n.attr("href",$("#contextPath").val()+"/PbMyStowe/brandCollection");$("#ul_header").children().remove();$("#ul_header").append(m)}else{var m=getNoLoginHtml(loginbaseUrl,k);var n=$("#headermystow");n.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(m)}},error:function(){},data:{credential:f}})}else{if(typeof(b)!=="undefined"&&typeof(i)!=="undefined"&&i!==""&&i!==null){$.ajax({type:"post",datatype:"json",async:false,url:loginbaseUrl+"/user/tocheckLoginInfo?t="+new Date(),success:function(p){g=p.resp;if(g!=null&&g!=""){Setcookie("isLogin","yes",60*60*1000);var n=getLoginHtml(k,g);var o=$("#headermystow");o.attr("href",$("#contextPath").val()+"/PbMyStowe/brandCollection");$("#ul_header").children().remove();$("#ul_header").append(n)}else{var n=getNoLoginHtml(loginbaseUrl,k);var o=$("#headermystow");o.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(n)}var m=getCookie("mlh_mei_credential");if(typeof(m)!=="undefined"&&m!=""){handleSSO(h,l,b,i,m)}},error:function(){g="fail"},data:{userAccount:b,passWord:i}})}else{var d=getNoLoginHtml(loginbaseUrl,k);var e=$("#headermystow");e.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(d)}}}else{var d=getNoLoginHtml(loginbaseUrl,k);var e=$("#headermystow");e.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(d)}}});function getCookie(e){var d=document.cookie;var b=d.indexOf(e);if(b!=-1){b+=e.length+1;var c=d.indexOf(";",b);if(c==-1){c=d.length}var a=unescape(d.substring(b,c))}return a}function toLoginOut(c){var b=getCookie("mlh_mei_credential");var g=$("#basePath").val();var a=$("#hkBasePath").val();var d=location.href;var f="";if(d.indexOf(a)!=-1){f=g}else{f=a}if(typeof(a)!=="undefined"&&"http://"!=a){var e=document.createElement("iframe");e.style.display="none";e.src=f+"/sso.jsp?glms_uu=&glms_up=&isLogin=&mlh_mei_credential=";document.body.appendChild(e)}$.ajax({type:"post",datatype:"json",async:false,url:loginbaseUrl+"/user/toLoginOut?t="+new Date(),data:{credential:b},beforeSend:function(h){h.withCredentials=true},success:function(j){var h=getNoLoginHtml(loginbaseUrl,g);var i=$("#headermystow");i.attr("href","");i.attr("href",$("#contextPath").val()+"/user/tologinpage");$("#ul_header").children().remove();$("#ul_header").append(h);Setcookie("glms_up","");Setcookie("isLogin","",1);if(d.indexOf(a)!=-1){Setcookie("mlh_mei_credential","")}if(1==c){location.reload()}else{showSmallBag(true)}},error:function(){}})}function toBankLoginOut(){$.ajax({type:"post",datatype:"json",async:false,url:loginbaseUrl+"/user/toLoginOut",success:function(a){Setcookie("glms_up","");window.location.href=loginbaseUrl+"/index.html"},error:function(){}})}function loginBankSuccess(){var b=new CustomdDialogPlugin();var c=isLogins();if(c=="login"){cpsSuccess()}else{var a=getSingleUrl();if(a==""){window.location.reload()}$("#loginBankIframe").attr("src",a);b.showdiv("loginBank")}}function getSingleUrl(){var a="";$.ajax({type:"GET",async:false,url:loginbaseUrl+"/home/createsingleurl",dataType:"text",success:function(b){a=b},error:function(){a=""}});return a}function cpsSuccess(){var b=$("#basePath").val();var a='<li><img src="'+loginbaseUrl+'/images/bank_top_image3.png"/></li>';a+='<li style="border-right:1px solid white;padding-right:15px;" onclick="location.href=\''+loginbaseUrl+'/checkout/cart\'" onmouseover="showSmallBag();" >';a+='购物袋(<font color="red"><span id="countBank">0</span></font>)件';a+='</li><li class="theLi">';a+='<a style="color: white" href="'+b+'/myMeiOrders/myOrderList">我的魅力惠</a>';a+="</li><li>|</li>";a+='<li><a  onclick="toBankLoginOut();"><font color="white">退出</font></a></li>';$("#cps_login_top_ul").html(a);$("#loginBankIframe").attr("src","")}function Setcookie(a,c,d){var b=new Date();if(typeof(d)!=="undefined"&&d!==null&&d!==""){b.setTime(b.getTime()+d)}else{b.setTime(b.getTime()+365*24*60*60*1000)}document.cookie=a+"="+c+";expires="+b.toGMTString()+";path=/"}function isLogins(){var a="";$.ajax({type:"post",datatype:"json",async:false,url:loginbaseUrl+"/user/isLogin",success:function(b){a=b.result},error:function(){a="fail"}});return a}function getLoginHtml(c,b){var a="";a+="<input type=hidden id=user_telphone value="+b.telphone+">";a+="<input type=hidden id=user_id value="+b.id+">";if(b.customer_name!=null){a+='<li class="theLi" id="pup_mei">';a+='<div class="pop_up" >';a+='<div class="pop_up_myGlamour" >';a+="<ul>";a+='<li><a class="order">订单管理</a></li>';a+='<li><a class="comment">购物评价</a></li>';a+='<li><a class="coupon">优惠券</a></li>';a+='<li><a class="information">账户信息</a></li>';a+='<li><a class="address">地址信息</a></li>';a+='<li><a class="password">修改密码</a></li>';a+="</ul>";a+="</div>";a+="</div>";if(b.customer_name!=null&&b.customer_name==""){a+='<a class="myMlh" style="color:red;" href="'+c+'/myMeiOrders/myOrderList">我的账户</a>'}else{a+='<a class="myMlh" style="color:red;" href="'+c+'/myMeiOrders/myOrderList">'+b.customer_name+"</a>"}a+="</li>"}a+='<li class="theLi"><a style="margin-left:12px" onclick="toLoginOut();">退出</a></li>';a+='<li class="theLi"><span>|</span></li>';a+='<li class="theLi">';a+='<div class="pop_up">';a+=' <div id="collect_tag_dialog" class="pop_up_box6" style="display:none;">';a+='     <div class="box_top">';a+='       <div class="top_img">';a+="</div>";a+="</div>";a+='<div class="box_content">收藏成功!</div>';a+="</div>";a+="</div>";if(b.id!=null&&b.id!=""){a+="<a href="+c+"/PbMyStowe/brandCollection>收藏</a>"}else{a+="<a href="+c+"/user/tologinpage>收藏</a>"}a+="</li>";return a}function getNoLoginHtml(c,b){var a='<li class="theLi">';a+='<img class="youli" src="'+c+'/images/zhuceyouli.gif" />';a+='<a href="'+b+'/user/toregistpage" style="color: red;">注册有礼</a></li>';a+='<li class="theLi"><span>|</span></li>';a+='<li class="theLi">';a+='<a onclick="toLogin()">登录</a></li>';a+='<li class="theLi"><span>|</span></li>';a+='<li class="theLi">';a+='<div class="pop_up">';a+=' <div id="collect_tag_dialog" class="pop_up_box6" style="display:none;">';a+='     <div class="box_top">';a+='       <div class="top_img">';a+="</div>";a+="</div>";a+='<div class="box_content">收藏成功!</div>';a+="</div>";a+="</div>";a+="<a href="+b+"/user/tologinpage>收藏</a>";a+="</li>";return a}function handleSSO(a,e,c,f,b){if("http://"!=a){var d=document.createElement("iframe");d.style.display="none";if('""'==f){d.src=e+"/sso.jsp?glms_uu="+c+"&glms_up=&isLogin=yes"}else{d.src=e+"/sso.jsp?glms_uu="+c+"&glms_up="+f+"&isLogin=yes"}if(typeof(b)!=="undefined"&&b!==""){d.src=d.src+"&mlh_mei_credential="+b}document.body.appendChild(d)}};